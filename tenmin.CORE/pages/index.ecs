<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>10 min host</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        html, body{
            width:100%;
            height: 100%;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        #logo {
            width: 400px;
            height: 400px;
            position: absolute;
            top:0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
        }
        #icon{
            font-size: 380px;
        }
        #previewDiv{
            position: relative;
        }
        button{
            border-radius: 5px;
            border: 3px solid #212121;
            height: 60px;
            background-color: #F5F5F5;
            margin: 0;
            width: 198px;
        }
        p{
            padding-top: 20px;
            font-family: 'Oxygen', sans-serif;
            font-size: 14pt;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="logo">
        <div class="fa fa-cloud-upload" id="icon"></div>
        <div ><p id="nfileName"></p></div>
        <div id="previewDiv"></div>
    </div>
    <script>
        var id = '<% id %>', canUpload = <% canUpload %>;
        var title = $("#nfileName");
        var template = '<div id="template" class="file-row"> <div> <p class="name" data-dz-name></p> <strong class="error text-danger" data-dz-errormessage></strong> </div> <div> <p class="size" data-dz-size></p> <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"> <div class="progress-bar progress-bar-success" style="width:0%;" data-dz-uploadprogress></div> </div> </div> <div> <button class="btn btn-primary start"> <span>Start</span> </button> <button data-dz-remove class="btn btn-warning cancel"> <span>Cancel</span> </button> </div></div>';

        if (id != ""){
            var icon = $('#icon');
            icon.removeClass("fa-cloud-upload").addClass("fa-cloud-download");
            icon.click(function () {
                window.location.replace("/" + id + '/download');
            });
            title.text(id);
            title.click(function () {
                window.location.replace("/" + id + '/download');
            });
        }
        else {
            if (!canUpload){
                title.text('Please try again in 5 - 10 minutes');
            }
            else{
                title.text('Drag and drop the file');
                var dropzone = new Dropzone(document.body, { // Make the whole body a dropzone
                    url: "/upload", // Set the url
                    maxFiles: 1,
                    maxFileSize: 500,
                    previewTemplate: template,
                    autoQueue: false, // Make sure the files aren't queued until manually added
                    previewsContainer: "#previewDiv", // Define the container to display the previews
                    clickable: "#icon" // Define the element that should be used as click trigger to select files.
                });

                dropzone.on("success", function(file, responseText) {
                    window.location.replace("/" + responseText);
                });

                dropzone.on("maxfilesexceeded", function(file) {
                    dropzone.removeAllFiles();
                    dropzone.addFile(file);
                });

                dropzone.on("addedfile", function(file) {
                    file.previewElement.querySelector(".start").onclick = function() { dropzone.enqueueFile(file); };
                });

                dropzone.on("totaluploadprogress", function(progress) {
                    var bar = document.querySelector(".progress-bar");
                    if (bar) bar.style.width = progress + "%";
                });

                dropzone.on("sending", function(file) {
                    document.querySelector(".progress").style.opacity = "1";
                    file.previewElement.querySelector(".start").setAttribute("disabled", "disabled");
                });

                dropzone.on("queuecomplete", function(progress) {
                    document.querySelector(".progress").style.opacity = "0";
                });
            }
        }
    </script>
</body>
</html>